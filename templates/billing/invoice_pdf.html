<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <title>Facture {{ invoice.invoice_number }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    {% load static %}
</head>
<style>
    @page {
        size: A4;
        margin: 1cm;
    }
    
    body {
        font-family: 'Helvetica', 'Arial', sans-serif;
        background-color: #ffffff;
        margin: 0;
        padding: 0;
        font-size: 10pt;
        line-height: 1.4;
    }
    
    .invoice-container {
        width: 100%;
        max-width: 210mm;
        margin: 0 auto;
        background: white;
    }
    
    /* Header Section */
    .invoice-header {
        border-bottom: 3px solid #4A90E2;
        padding-bottom: 15px;
        margin-bottom: 20px;
    }
    
    .header-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .header-table td {
        vertical-align: top;
        padding: 5px;
    }
    
    .logo-section {
        width: 35%;
        text-align: left;
    }
    
    .logo-section img {
        max-width: 140px;
        height: auto;
    }
    
    .company-info {
        width: 65%;
        text-align: right;
    }
    
    .company-name {
        font-size: 24pt;
        font-weight: bold;
        color: #4A90E2;
        margin: 0 0 5px 0;
        letter-spacing: 1px;
    }
    
    .company-tagline {
        font-size: 9pt;
        color: #666;
        font-weight: 600;
        margin-bottom: 8px;
    }
    
    .company-details {
        font-size: 9pt;
        color: #333;
        line-height: 1.6;
    }
    
    .company-details span {
        color: #4A90E2;
        font-weight: 600;
    }
    
    /* Invoice Info Section */
    .invoice-info {
        width: 100%;
        margin-bottom: 20px;
        border-collapse: collapse;
    }
    
    .invoice-info td {
        padding: 8px;
        vertical-align: top;
    }
    
    .client-box {
        background: #F8F9FA;
        border-left: 4px solid #4A90E2;
        padding: 12px;
        width: 33%;
    }
    
    .client-box h4 {
        margin: 0 0 8px 0;
        font-size: 9pt;
        color: #666;
        font-weight: normal;
    }
    
    .client-box h3 {
        margin: 0 0 6px 0;
        font-size: 12pt;
        color: #4A90E2;
        font-weight: bold;
    }
    
    .client-box div {
        font-size: 9pt;
        color: #333;
        margin-bottom: 3px;
    }
    
    .invoice-type-box {
        text-align: center;
        width: 34%;
    }
    
    .invoice-type {
        display: inline-block;
        background: #4A90E2;
        color: white;
        padding: 8px 20px;
        font-size: 14pt;
        font-weight: bold;
        border-radius: 5px;
    }
    
    .invoice-number-box {
        background: #F8F9FA;
        border-right: 4px solid #4A90E2;
        padding: 12px;
        text-align: right;
        width: 33%;
    }
    
    .invoice-number {
        font-size: 11pt;
        color: #4A90E2;
        font-weight: bold;
        margin-bottom: 8px;
    }
    
    .invoice-dates {
        font-size: 9pt;
        color: #333;
    }
    
    .invoice-dates div {
        margin-bottom: 3px;
    }
    
    /* Subject Section */
    .subject-section {
        margin-bottom: 15px;
        font-size: 10pt;
    }
    
    .subject-section strong {
        color: #333;
    }
    
    /* Items Table */
    .items-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 15px;
    }
    
    .items-table thead th {
        background: #4A90E2;
        color: white;
        padding: 10px 8px;
        text-align: center;
        font-size: 9pt;
        font-weight: bold;
        border: 1px solid #3A80D2;
    }
    
    .items-table thead th:nth-child(2) {
        text-align: left;
    }
    
    .items-table tbody td {
        padding: 8px;
        background: #F8F9FA;
        border-bottom: 2px solid white;
        font-size: 9pt;
    }
    
    .items-table tbody .item-number {
        background: #4A90E2;
        color: white;
        text-align: center;
        font-weight: bold;
        width: 5%;
    }
    
    .items-table tbody .item-desc {
        text-align: left;
        width: 40%;
        color: #333;
    }
    
    .items-table tbody .item-qty,
    .items-table tbody .item-unit {
        text-align: center;
        width: 15%;
        background: #E8E9EA;
    }
    
    .items-table tbody .item-total {
        background: #4A90E2;
        color: white;
        text-align: center;
        font-weight: bold;
        width: 20%;
    }
    
    /* Totals Section */
    .totals-table {
        width: 100%;
        margin-bottom: 15px;
        border-collapse: collapse;
    }
    
    .totals-table td {
        padding: 6px 10px;
        font-size: 9pt;
    }
    
    .totals-table .label-col {
        text-align: right;
        width: 75%;
        font-weight: 600;
        color: #333;
    }
    
    .totals-table .amount-col {
        text-align: right;
        width: 25%;
        font-weight: bold;
        color: #333;
    }
    
    .totals-table .total-ht-row {
        border-top: 1px solid #DDD;
    }
    
    .totals-table .tax-row .amount-col {
        color: #E74C3C;
    }
    
    .totals-table .total-ttc-row {
        border-top: 2px solid #4A90E2;
    }
    
    .totals-table .total-ttc-row .label-col,
    .totals-table .total-ttc-row .amount-col {
        font-size: 10pt;
        color: #4A90E2;
    }
    
    .totals-table .net-to-pay-row {
        background: #4A90E2;
        color: white;
    }
    
    .totals-table .net-to-pay-row .label-col,
    .totals-table .net-to-pay-row .amount-col {
        font-size: 11pt;
        font-weight: bold;
        color: white;
    }
    
    /* Thank You */
    .thank-you {
        text-align: left;
        font-size: 12pt;
        font-weight: bold;
        color: #333;
        margin: 15px 0;
    }
    
    /* Notes Box */
    .notes-box {
        background: #E8F4FD;
        border-left: 6px solid #4A90E2;
        padding: 12px 15px;
        margin-bottom: 20px;
    }
    
    .notes-title {
        color: #4A90E2;
        font-size: 10pt;
        font-weight: bold;
        margin-bottom: 5px;
        text-decoration: underline;
    }
    
    .notes-content {
        font-size: 9pt;
        color: #333;
        line-height: 1.6;
    }
    
    /* Footer */
    .invoice-footer {
        border-top: 2px solid #4A90E2;
        padding-top: 10px;
        text-align: center;
        font-size: 8pt;
        color: #666;
        margin-top: 20px;
    }
    
    .invoice-footer .accounts {
        margin-bottom: 5px;
        line-height: 1.5;
    }
    
    .invoice-footer .legal {
        font-weight: bold;
        color: #333;
    }
</style>
<body>
    <div class="invoice-container">
        <!-- Header -->
        <div class="invoice-header">
            <table class="header-table">
                <tr>
                    <td class="logo-section">
                        <img src="{{ logo_url }}" alt="Belle House Logo" style="max-width: 140px; height: auto;" />
                    </td>
                    <td class="company-info">
                        <div class="company-name">BELLE HOUSE</div>
                        <div class="company-tagline">ENTREPRISE DE CONSTRUCTION MODERNE</div>
                        <div class="company-details">
                            <div>Adresse : <span>Bobiel Niamey-Niger</span></div>
                            <div>Numéro de téléphone : <span>+227 92 08 50 50</span></div>
                            <div>Email: <span>Contact@bellehouseniger.com</span></div>
                            <div>Site Web: <span>bellehouseniger.com</span></div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <!-- Invoice Info -->
        <table class="invoice-info">
            <tr>
                <td class="client-box">
                    <h4>Délivré à:</h4>
                    <h3>{{ invoice.client_name }}</h3>
                    <div>{{ invoice.client_address|default:"Niamey-Niger" }}</div>
                    <div>Tél: {{ invoice.client_phone }}</div>
                    <div>{{ invoice.project.client.user.email }}</div>
                </td>
                <td class="invoice-type-box">
                    <div class="invoice-type">Facture Proforma</div>
                </td>
                <td class="invoice-number-box">
                    <div class="invoice-number">Numéro : {{ invoice.invoice_number }}</div>
                    <div class="invoice-dates">
                        <div><strong>Date:</strong> {{ invoice.issue_date|date:"d-m-Y" }}</div>
                        <div><strong>Échéance:</strong> {{ invoice.due_date|date:"d-m-Y" }}</div>
                    </div>
                </td>
            </tr>
        </table>

        <!-- Subject -->
        <div class="subject-section">
            <strong>Objet:</strong> {{ invoice.subject }}
        </div>

        <!-- Items Table -->
        <table class="items-table">
            <thead>
                <tr>
                    <th style="width: 5%;">#</th>
                    <th style="width: 40%; text-align: left;">Désignation</th>
                    <th style="width: 15%;">Quantité</th>
                    <th style="width: 20%;">Prix Unitaire HT<br/>(FCFA)</th>
                    <th style="width: 20%;">Prix Total HT<br/>(FCFA)</th>
                </tr>
            </thead>
            <tbody>
                {% for item in invoice.items.all %}
                <tr>
                    <td class="item-number">{{ forloop.counter }}</td>
                    <td class="item-desc">{{ item.description }}</td>
                    <td class="item-qty">{{ item.quantity|floatformat:0 }}</td>
                    <td class="item-unit">{{ item.unit_price|floatformat:0 }}</td>
                    <td class="item-total">{{ item.total_price|floatformat:0 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Totals -->
        <table class="totals-table">
            <tr class="total-ht-row">
                <td class="label-col">Montant Total HT</td>
                <td class="amount-col">{{ invoice.subtotal|floatformat:0 }} FCFA</td>
            </tr>
            <tr class="tax-row">
                <td class="label-col">
                    {% if invoice.tax_amount != 0 %}
                        {% if invoice.tax_type == 'ISB' %}
                            ISB ({{ invoice.tax_percentage }}%)
                        {% elif invoice.tax_type == 'TVA' %}
                            TVA ({{ invoice.tax_percentage }}%)
                        {% elif invoice.tax_type == 'CUSTOM' %}
                            Taxe ({{ invoice.tax_percentage }}%)
                        {% else %}
                            Taxe ({{ invoice.tax_percentage }}%)
                        {% endif %}
                    {% else %}
                        Taxe (0%)
                    {% endif %}
                </td>
                <td class="amount-col">{{ invoice.tax_amount|floatformat:0 }} FCFA</td>
            </tr>
            <tr class="total-ttc-row">
                <td class="label-col">Montant Total TTC</td>
                <td class="amount-col">{{ invoice.total_ttc|floatformat:0 }} FCFA</td>
            </tr>
            {% if invoice.advance_payment > 0 %}
            <tr>
                <td class="label-col">Acompte Versé</td>
                <td class="amount-col" style="color: #27AE60;">-{{ invoice.advance_payment|floatformat:0 }} FCFA</td>
            </tr>
            {% endif %}
            <tr class="net-to-pay-row">
                <td class="label-col">Net à payer</td>
                <td class="amount-col">{{ invoice.net_to_pay|floatformat:0 }} FCFA</td>
            </tr>
        </table>

        <!-- Thank You -->
        <div class="thank-you">Merci!</div>

        <!-- Notes -->
        <div class="notes-box">
            <div class="notes-title">NOTE Importante!</div>
            <div class="notes-content">
                <strong>Mode de règlement:</strong> {{ invoice.get_payment_mode_display }}
                {% if invoice.notes %}
                <br/><br/><strong>Remarques:</strong> {{ invoice.notes }}
                {% else %}
                <br/><br/><strong>Remarques:</strong> Pas de notes
                {% endif %}
            </div>
        </div>

        <!-- Footer -->
        <div class="invoice-footer">
            <div class="accounts">
                Compte Ecobank: <strong>160940732001</strong> | 
                Compte Orabank: <strong>76495401901</strong> | 
                Compte BIA: <strong>61001260006</strong> | 
                Compte BOA: <strong>004404430009</strong>
            </div>
            <div class="legal">RCCM-NE-NIM-01-2017-A10-02845 - NIF : 43391/P.</div>
        </div>
    </div>
</body>
</html>
